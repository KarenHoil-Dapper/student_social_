{% extends "base.html" %}

{% block title %}Estadísticas - {{ super() }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <h2 class="text-center mb-4">
            <i class="fas fa-chart-bar"></i>
            Estadísticas del Sistema con Análisis Visual
        </h2>
        
        <div class="row">
            <div class="col-md-3 mb-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-users fa-2x text-primary mb-2"></i>
                        <h3>{{ stats.total_surveys }}</h3>
                        <p class="text-muted">Total Encuestas</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-heart fa-2x text-success mb-2"></i>
                        <h3>{{ "%.1f"|format(stats.avg_mental_health_score) }}</h3>
                        <p class="text-muted">Salud Mental Promedio</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-graduation-cap fa-2x text-warning mb-2"></i>
                        <h3>{{ "%.1f"|format(stats.academic_impact_percentage) }}%</h3>
                        <p class="text-muted">Impacto Académico</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3 mb-4">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-calendar fa-2x text-info mb-2"></i>
                        <h3>{{ stats.recent_surveys }}</h3>
                        <p class="text-muted">Último Mes</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Grafica horizontal Global -->
        {% if stats.global_horizontal %}
        <div class="card mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0"><i class="fas fa-fire"></i> Grafica horizontal Global - Correlaciones</h5>
            </div>
            <div class="card-body text-center">
                <div class="chart-container">
                    <img src="data:image/png;base64,{{ stats.global_horizontal }}" 
                         class="chart-image" alt="Grafica horizontal Global">
                </div>
                <p class="mt-3 text-muted">
                    Correlaciones entre diferentes métricas de salud mental de todos los usuarios.
                    Los colores azules indican correlación positiva, los rojos correlación negativa.
                </p>
            </div>
        </div>
        {% endif %}
        
        <!-- Gráficas de Tendencias -->
        {% if stats.trends_chart %}
        <div class="card mb-4">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fas fa-chart-line"></i> Tendencias Temporales</h5>
            </div>
            <div class="card-body text-center">
                <div class="chart-container">
                    <img src="data:image/png;base64,{{ stats.trends_chart }}" 
                         class="chart-image" alt="Gráficas de Tendencias">
                </div>
                <p class="mt-3 text-muted">
                    Evolución temporal de las métricas principales del sistema.
                </p>
            </div>
        </div>
        {% endif %}
        
        {% if not stats.global_horizontal and not stats.trends_chart %}
        <div class="alert alert-info text-center">
            <i class="fas fa-info-circle"></i>
            <strong>Nota:</strong> Se necesitan más datos para generar visualizaciones. 
            Las gráficas aparecerán cuando haya suficientes encuestas completadas.
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}