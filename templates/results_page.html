<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resultados del An√°lisis ML - Redes Sociales</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --warning-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --danger-gradient: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --card-shadow: 0 15px 35px rgba(0,0,0,0.1);
            --hover-transform: translateY(-5px);
        }

        body {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            font-family: 'Inter', 'Segoe UI', sans-serif;
            line-height: 1.6;
        }

        .navbar {
            background: var(--primary-gradient) !important;
            backdrop-filter: blur(20px);
            box-shadow: var(--card-shadow);
        }

        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }

        .main-container {
            margin-top: 20px;
            margin-bottom: 40px;
        }

        .result-header {
            background: white;
            border-radius: 25px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            background: var(--primary-gradient);
        }

        .score-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .score-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid rgba(102, 126, 234, 0.1);
            position: relative;
            overflow: hidden;
        }

        .score-card:hover {
            transform: var(--hover-transform);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }

        .score-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .score-card.mental::before { background: var(--success-gradient); }
        .score-card.addiction::before { background: var(--warning-gradient); }
        .score-card.percentile::before { background: var(--primary-gradient); }

        .score-value {
            font-size: 3rem;
            font-weight: 700;
            margin: 10px 0;
            background: var(--primary-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .score-label {
            font-size: 1.1rem;
            color: #64748b;
            margin-bottom: 10px;
        }

        .score-status {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .status-good { background: #d4edda; color: #155724; }
        .status-moderate { background: #fff3cd; color: #856404; }
        .status-warning { background: #f8d7da; color: #721c24; }

        .chart-section {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--card-shadow);
        }

        .chart-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .chart-title i {
            background: var(--primary-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: white;
            margin-right: 10px;
            font-size: 1.5rem;
        }

        .chart-container {
            margin: 20px 0;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        .model-tabs {
            display: flex;
            background: #f8fafc;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .model-tab {
            flex: 1;
            background: transparent;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 120px;
        }

        .model-tab.active {
            background: white;
            color: #667eea;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .model-tab:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
        }

        .recommendations-section {
            background: linear-gradient(135deg, #f0fff4 0%, #c6f6d5 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 6px solid #48bb78;
        }

        .recommendation-item {
            background: white;
            padding: 15px 20px;
            margin: 10px 0;
            border-radius: 15px;
            border-left: 4px solid #48bb78;
            transition: all 0.3s ease;
        }

        .recommendation-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .explanation-section {
            background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 6px solid #f56565;
        }

        .explanation-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 15px 0;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .stat-item {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .stat-item:hover {
            transform: var(--hover-transform);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            background: var(--primary-gradient);
            background-clip: text;
            -webkit-background-clip: text;
            color: #667eea;
        }

        .stat-label {
            color: #64748b;
            font-weight: 500;
            margin-top: 5px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 30px 0;
        }

        .btn-custom {
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }

        .btn-primary-custom {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
            color: white;
        }

        .btn-outline-custom {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-outline-custom:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .chart-explanation {
            background: #f8fafc;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border-left: 4px solid #667eea;
        }

        .model-info {
            background: #e6fffa;
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #38b2ac;
        }

        .comparison-highlight {
            background: linear-gradient(135deg, #fef5e7 0%, #fed7aa 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            border: 2px solid #f6ad55;
        }

        .loading-chart {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .result-header {
                padding: 25px;
            }
            
            .chart-section {
                padding: 20px;
            }
            
            .model-tabs {
                flex-direction: column;
            }
            
            .model-tab {
                text-align: center;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-brain"></i> An√°lisis ML - Resultados
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/">
                    <i class="fas fa-arrow-left"></i> Nuevo An√°lisis
                </a>
            </div>
        </div>
    </nav>

    <div class="container main-container">
        <!-- Header con Resumen -->
        <div class="result-header">
            <h1><i class="fas fa-chart-line"></i> Tu An√°lisis de Redes Sociales</h1>
            <p class="lead">Resultados basados en Machine Learning con {{ stats.total_users }} usuarios comparados</p>
            
            <!-- Score Cards -->
            <div class="score-cards">
                <div class="score-card mental">
                    <div class="score-label">Salud Mental</div>
                    <div class="score-value">{{ "%.1f"|format(results.mental_health.values()|list|sum / results.mental_health.values()|list|length) }}</div>
                    <div class="score-status {% if (results.mental_health.values()|list|sum / results.mental_health.values()|list|length) >= 7 %}status-good{% elif (results.mental_health.values()|list|sum / results.mental_health.values()|list|length) >= 4 %}status-moderate{% else %}status-warning{% endif %}">
                        {% if (results.mental_health.values()|list|sum / results.mental_health.values()|list|length) >= 7 %}
                            Excelente
                        {% elif (results.mental_health.values()|list|sum / results.mental_health.values()|list|length) >= 4 %}
                            Moderado
                        {% else %}
                            Necesita Atenci√≥n
                        {% endif %}
                    </div>
                </div>
                
                <div class="score-card addiction">
                    <div class="score-label">Nivel de Adicci√≥n</div>
                    <div class="score-value">{{ "%.1f"|format(results.addiction.values()|list|sum / results.addiction.values()|list|length) }}</div>
                    <div class="score-status {% if (results.addiction.values()|list|sum / results.addiction.values()|list|length) < 4 %}status-good{% elif (results.addiction.values()|list|sum / results.addiction.values()|list|length) < 7 %}status-moderate{% else %}status-warning{% endif %}">
                        {% if (results.addiction.values()|list|sum / results.addiction.values()|list|length) < 4 %}
                            Bajo
                        {% elif (results.addiction.values()|list|sum / results.addiction.values()|list|length) < 7 %}
                            Moderado
                        {% else %}
                            Alto
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas Comparativas -->
        <div class="chart-section">
            <h2 class="chart-title">
                <i class="fas fa-users"></i>
                Comparaci√≥n con Otros Usuarios
            </h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">{{ stats.total_users }}</div>
                    <div class="stat-label">Usuarios Comparados</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ stats.better_mental }}</div>
                    <div class="stat-label">Usuarios con Menor Salud Mental</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ stats.better_addiction }}</div>
                    <div class="stat-label">Usuarios con Mayor Adicci√≥n</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">{{ user_data.edad }}</div>
                    <div class="stat-label">Tu Edad</div>
                </div>
            </div>
        </div>

        <!-- Gr√°ficas de Salud Mental por Modelo -->
        <div class="chart-section">
            <h2 class="chart-title">
                <i class="fas fa-brain"></i>
                An√°lisis de Salud Mental - Tu Posici√≥n
            </h2>
            <div class="model-info">
                <strong>¬øQu√© muestran estas gr√°ficas?</strong><br>
                Cada modelo de ML analiza tu salud mental desde diferentes perspectivas. 
                La l√≠nea roja muestra tu posici√≥n comparada con todos los dem√°s usuarios.
            </div>
            
            <div class="model-tabs" id="mentalTabs">
                {% for model_name in mental_graphs.keys() %}
                <button class="model-tab {% if loop.first %}active{% endif %}" 
                        onclick="showMentalChart('{{ model_name }}')">
                    {{ model_name.replace('_', ' ').title() }}
                </button>
                {% endfor %}
            </div>
            
            {% for model_name, graph_json in mental_graphs.items() %}
            <div class="chart-container" id="mental_{{ model_name }}" 
                 {% if not loop.first %}style="display:none"{% endif %}>
                <div id="mental_chart_{{ model_name }}"></div>
                <div class="chart-explanation">
                    <strong>{{ model_name.replace('_', ' ').title() }}:</strong>
                    {% if model_name == 'linear' %}
                        Utiliza relaciones lineales para predecir tu salud mental bas√°ndose en patrones directos.
                    {% elif model_name == 'random_forest' %}
                        Combina m√∫ltiples √°rboles de decisi√≥n para una predicci√≥n m√°s robusta y precisa.
                    {% elif model_name == 'decision_tree' %}
                        Crea un √°rbol de decisiones basado en tus caracter√≠sticas m√°s importantes.
                    {% endif %}
                    Tu puntuaci√≥n: <strong>{{ "%.1f"|format(results.mental_health[model_name]) }}/10</strong>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Gr√°ficas de Adicci√≥n por Modelo -->
        <div class="chart-section">
            <h2 class="chart-title">
                <i class="fas fa-mobile-alt"></i>
                An√°lisis de Adicci√≥n - Tu Posici√≥n
            </h2>
            <div class="model-info">
                <strong>¬øQu√© muestran estas gr√°ficas?</strong><br>
                Eval√∫an tu nivel de adicci√≥n a redes sociales usando diferentes algoritmos. 
                Valores m√°s altos indican mayor riesgo de adicci√≥n.
            </div>
            
            <div class="model-tabs" id="addictionTabs">
                {% for model_name in addiction_graphs.keys() %}
                <button class="model-tab {% if loop.first %}active{% endif %}" 
                        onclick="showAddictionChart('{{ model_name }}')">
                    {{ model_name.replace('_', ' ').title() }}
                </button>
                {% endfor %}
            </div>
            
            {% for model_name, graph_json in addiction_graphs.items() %}
            <div class="chart-container" id="addiction_{{ model_name }}" 
                 {% if not loop.first %}style="display:none"{% endif %}>
                <div id="addiction_chart_{{ model_name }}"></div>
                <div class="chart-explanation">
                    <strong>{{ model_name.replace('_', ' ').title() }}:</strong>
                    {% if model_name == 'linear' %}
                        An√°lisis lineal de patrones de adicci√≥n basado en tus h√°bitos digitales.
                    {% elif model_name == 'random_forest' %}
                        Predicci√≥n ensemble que considera m√∫ltiples factores de riesgo de adicci√≥n.
                    {% elif model_name == 'decision_tree' %}
                        √Årbol de decisiones que identifica los factores m√°s cr√≠ticos en tu caso.
                    {% endif %}
                    Tu puntuaci√≥n: <strong>{{ "%.1f"|format(results.addiction[model_name]) }}/10</strong>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Gr√°ficas Radar de Comparaci√≥n -->
        <div class="row">
            <div class="col-md-6">
                <div class="chart-section">
                    <h3 class="chart-title">
                        <i class="fas fa-heart"></i>
                        Comparaci√≥n Salud Mental
                    </h3>
                    <div id="radar_mental_chart"></div>
                    <div class="chart-explanation">
                        <strong>Interpretaci√≥n:</strong> La l√≠nea roja eres t√∫, la azul es el promedio general. 
                        Mientras m√°s externa sea tu l√≠nea, mejor es tu salud mental.
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="chart-section">
                    <h3 class="chart-title">
                        <i class="fas fa-exclamation-triangle"></i>
                        Comparaci√≥n Adicci√≥n
                    </h3>
                    <div id="radar_addiction_chart"></div>
                    <div class="chart-explanation">
                        <strong>Interpretaci√≥n:</strong> La l√≠nea roja eres t√∫, la azul es el promedio general. 
                        Mientras m√°s interna sea tu l√≠nea, menor es tu riesgo de adicci√≥n.
                    </div>
                </div>
            </div>
        </div>

        <!-- Comparaciones Demogr√°ficas -->
        <div class="chart-section">
            <h2 class="chart-title">
                <i class="fas fa-chart-bar"></i>
                Comparaciones Demogr√°ficas
            </h2>
            <div class="comparison-highlight">
                <h4>üéØ Tu Grupo Demogr√°fico</h4>
                <p>Comparaciones espec√≠ficas con usuarios de caracter√≠sticas similares a las tuyas</p>
            </div>
            
            <div class="row">
                <div class="col-md-6">
                    <h4>Por Grupo de Edad</h4>
                    <div id="demographic_age_chart"></div>
                </div>
                <div class="col-md-6">
                    <h4>Por Nivel de Uso Diario</h4>
                    <div id="demographic_usage_chart"></div>
                </div>
            </div>
        </div>

        <!-- Precisi√≥n de Modelos -->
        <div class="chart-section">
            <h2 class="chart-title">
                <i class="fas fa-cogs"></i>
                Precisi√≥n de los Modelos ML
            </h2>
            <div id="accuracy_chart"></div>
            <div class="model-info">
                <strong>¬øPor qu√© es importante?</strong><br>
                Esta gr√°fica muestra qu√© tan precisos son nuestros modelos. Todos tienen m√°s del 75% de precisi√≥n, 
                garantizando resultados confiables en tu an√°lisis.
            </div>
        </div>

        <!-- Explicaciones Detalladas -->
        <div class="explanation-section">
            <h2><i class="fas fa-lightbulb"></i> Explicaci√≥n de tus Resultados</h2>
            
            <div class="explanation-card">
                <h4><i class="fas fa-brain"></i> Salud Mental</h4>
                <p>{{ results.explanations.mental_health }}</p>
            </div>
            
            <div class="explanation-card">
                <h4><i class="fas fa-mobile-alt"></i> Adicci√≥n a Redes Sociales</h4>
                <p>{{ results.explanations.addiction }}</p>
            </div>
        </div>

        <!-- Recomendaciones Personalizadas -->
        <div class="recommendations-section">
            <h2><i class="fas fa-star"></i> Recomendaciones Personalizadas</h2>
            <p class="mb-4">Basadas en tu perfil espec√≠fico y los resultados de Machine Learning:</p>
            
            {% for recommendation in results.recommendations %}
            <div class="recommendation-item">
                {{ recommendation }}
            </div>
            {% endfor %}
        </div>

        <!-- Botones de Acci√≥n -->
        <div class="action-buttons">
            <a href="/" class="btn-custom btn-primary-custom">
                <i class="fas fa-redo"></i> Hacer Nuevo An√°lisis
            </a>
        </div>
    </div>

    <!-- JavaScript Data -->
    <script id="chart-data" type="application/json">
        {
            "mentalGraphs": {
                {% for model_name, graph_json in mental_graphs.items() %}
                "{{ model_name }}": {{ graph_json|safe }}{% if not loop.last %},{% endif %}
                {% endfor %}
            },
            "addictionGraphs": {
                {% for model_name, graph_json in addiction_graphs.items() %}
                "{{ model_name }}": {{ graph_json|safe }}{% if not loop.last %},{% endif %}
                {% endfor %}
            },
            "radarMental": {% if graphs.radar_mental %}{{ graphs.radar_mental|safe }}{% else %}null{% endif %},
            "radarAddiction": {% if graphs.radar_addiction %}{{ graphs.radar_addiction|safe }}{% else %}null{% endif %},
            "accuracyChart": {% if graphs.accuracy %}{{ graphs.accuracy|safe }}{% else %}null{% endif %},
            "demographicAge": {% if graphs.demographic_age %}{{ graphs.demographic_age|safe }}{% else %}null{% endif %},
            "demographicUsage": {% if graphs.demographic_usage %}{{ graphs.demographic_usage|safe }}{% else %}null{% endif %}
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Cargar datos de las gr√°ficas desde JSON
        const chartDataElement = document.getElementById('chart-data');
        const chartData = JSON.parse(chartDataElement.textContent);
        
        // Asignar datos a variables globales
        const mentalGraphs = chartData.mentalGraphs;
        const addictionGraphs = chartData.addictionGraphs;
        const radarMental = chartData.radarMental;
        const radarAddiction = chartData.radarAddiction;
        const accuracyChart = chartData.accuracyChart;
        const demographicAge = chartData.demographicAge;
        const demographicUsage = chartData.demographicUsage;

        // Funci√≥n para mostrar gr√°ficas de salud mental
        function showMentalChart(modelName) {
            // Ocultar todas las gr√°ficas
            Object.keys(mentalGraphs).forEach(model => {
                const element = document.getElementById(`mental_${model}`);
                if (element) element.style.display = 'none';
            });
            
            // Mostrar la gr√°fica seleccionada
            const targetElement = document.getElementById(`mental_${modelName}`);
            if (targetElement) {
                targetElement.style.display = 'block';
            }
            
            // Actualizar tabs activos
            document.querySelectorAll('#mentalTabs .model-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Renderizar la gr√°fica si existe
            if (mentalGraphs[modelName]) {
                try {
                    Plotly.newPlot(`mental_chart_${modelName}`, 
                                  mentalGraphs[modelName].data, 
                                  mentalGraphs[modelName].layout, 
                                  {responsive: true, displayModeBar: false});
                } catch (error) {
                    console.error('Error renderizando gr√°fica mental:', error);
                    document.getElementById(`mental_chart_${modelName}`).innerHTML = 
                        '<div class="alert alert-warning">Error cargando gr√°fica</div>';
                }
            }
        }

        // Funci√≥n para mostrar gr√°ficas de adicci√≥n
        function showAddictionChart(modelName) {
            // Ocultar todas las gr√°ficas
            Object.keys(addictionGraphs).forEach(model => {
                const element = document.getElementById(`addiction_${model}`);
                if (element) element.style.display = 'none';
            });
            
            // Mostrar la gr√°fica seleccionada
            const targetElement = document.getElementById(`addiction_${modelName}`);
            if (targetElement) {
                targetElement.style.display = 'block';
            }
            
            // Actualizar tabs activos
            document.querySelectorAll('#addictionTabs .model-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Renderizar la gr√°fica si existe
            if (addictionGraphs[modelName]) {
                try {
                    Plotly.newPlot(`addiction_chart_${modelName}`, 
                                  addictionGraphs[modelName].data, 
                                  addictionGraphs[modelName].layout, 
                                  {responsive: true, displayModeBar: false});
                } catch (error) {
                    console.error('Error renderizando gr√°fica adicci√≥n:', error);
                    document.getElementById(`addiction_chart_${modelName}`).innerHTML = 
                        '<div class="alert alert-warning">Error cargando gr√°fica</div>';
                }
            }
        }

        // Funci√≥n segura para renderizar gr√°ficas
        function safeRenderChart(elementId, chartData, fallbackMessage = 'Gr√°fica no disponible') {
            const element = document.getElementById(elementId);
            if (!element) {
                console.warn(`Elemento ${elementId} no encontrado`);
                return;
            }
            
            if (!chartData || !chartData.data) {
                element.innerHTML = `<div class="alert alert-info">${fallbackMessage}</div>`;
                return;
            }
            
            try {
                Plotly.newPlot(elementId, chartData.data, chartData.layout, {
                    responsive: true, 
                    displayModeBar: false,
                    showTips: false
                });
            } catch (error) {
                console.error(`Error renderizando ${elementId}:`, error);
                element.innerHTML = `<div class="alert alert-warning">Error cargando gr√°fica: ${error.message}</div>`;
            }
        }

        // Inicializar todas las gr√°ficas cuando se carga la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Inicializando gr√°ficas...');
            
            // Renderizar gr√°ficas iniciales de modelos
            const firstMentalModel = Object.keys(mentalGraphs)[0];
            const firstAddictionModel = Object.keys(addictionGraphs)[0];
            
            if (firstMentalModel && mentalGraphs[firstMentalModel]) {
                safeRenderChart(`mental_chart_${firstMentalModel}`, 
                              mentalGraphs[firstMentalModel], 
                              'Gr√°fica de salud mental no disponible');
            }
            
            if (firstAddictionModel && addictionGraphs[firstAddictionModel]) {
                safeRenderChart(`addiction_chart_${firstAddictionModel}`, 
                              addictionGraphs[firstAddictionModel], 
                              'Gr√°fica de adicci√≥n no disponible');
            }
            
            // Renderizar gr√°ficas radar
            safeRenderChart('radar_mental_chart', radarMental, 'Comparaci√≥n de salud mental no disponible');
            safeRenderChart('radar_addiction_chart', radarAddiction, 'Comparaci√≥n de adicci√≥n no disponible');
            
            // Renderizar gr√°fica de precisi√≥n
            safeRenderChart('accuracy_chart', accuracyChart, 'Gr√°fica de precisi√≥n no disponible');
            
            // Renderizar gr√°ficas demogr√°ficas
            safeRenderChart('demographic_age_chart', demographicAge, 'Comparaci√≥n por edad no disponible');
            safeRenderChart('demographic_usage_chart', demographicUsage, 'Comparaci√≥n por uso no disponible');
            
            console.log('Gr√°ficas inicializadas');
        });

        // Animaciones de entrada
        function animateOnScroll() {
            const elements = document.querySelectorAll('.chart-section, .score-card, .recommendation-item');
            
            elements.forEach(element => {
                const elementTop = element.getBoundingClientRect().top;
                const elementVisible = 150;
                
                if (elementTop < window.innerHeight - elementVisible) {
                    element.style.opacity = '1';
                    element.style.transform = 'translateY(0)';
                }
            });
        }

        // Inicializar elementos para animaci√≥n
        document.querySelectorAll('.chart-section, .score-card, .recommendation-item').forEach(element => {
            element.style.opacity = '0';
            element.style.transform = 'translateY(30px)';
            element.style.transition = 'all 0.6s ease';
        });

        // Listeners para animaciones
        window.addEventListener('scroll', animateOnScroll);
        window.addEventListener('load', animateOnScroll);

        // Funcionalidad de impresi√≥n mejorada
        window.addEventListener('beforeprint', function() {
            // Redimensionar gr√°ficas para impresi√≥n
            document.querySelectorAll('[id*="_chart"]').forEach(chart => {
                if (chart.style.display !== 'none') {
                    try {
                        Plotly.Plots.resize(chart);
                    } catch (error) {
                        console.warn('Error redimensionando para impresi√≥n:', error);
                    }
                }
            });
        });

        // Manejo de errores de Plotly
        window.addEventListener('error', function(e) {
            if (e.message && e.message.includes('Plotly')) {
                console.error('Error de Plotly detectado:', e.message);
                // Mostrar mensaje de error amigable al usuario
                const errorDiv = document.createElement('div');
                errorDiv.className = 'alert alert-warning';
                errorDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Algunas gr√°ficas pueden no cargar correctamente. Intenta recargar la p√°gina.';
                document.querySelector('.main-container').prepend(errorDiv);
            }
        });

        // Tooltip mejorado para elementos interactivos
        document.querySelectorAll('.score-card, .stat-item').forEach(element => {
            element.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px) scale(1.02)';
            });
            
            element.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) scale(1)';
            });
        });

        // Debug: Mostrar informaci√≥n de gr√°ficas en consola
        console.log('Mental graphs loaded:', Object.keys(mentalGraphs));
        console.log('Addiction graphs loaded:', Object.keys(addictionGraphs));
        console.log('Radar mental available:', !!radarMental);
        console.log('Radar addiction available:', !!radarAddiction);
        console.log('Accuracy chart available:', !!accuracyChart);
        console.log('Demographic charts available:', !!demographicAge, !!demographicUsage);
    </script>
</body>
</html>